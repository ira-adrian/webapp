{# ExpedienteBundle\Resources\views\Default\layout.html.twig#}
{% set edit = false %}
{% if tramite.id is defined %}
    {% if tramite.id is not null %}
            {% set edit = tramite | tramite_editar(app.user) %}
    {% endif %}
{% endif %}
{% if itemSolicitado.tramite.id is defined %}
            {% set edit = itemSolicitado.tramite | tramite_editar(app.user) %}
{% endif %}
{% if documento.tramite.id is defined %}
    {% set edit = documento.tramite | tramite_editar(app.user) %}
{% endif %}
{% extends '::base.html.twig' %}
{% block title %} Escritorio {% endblock %}
{% block stylesheets %}   
     <link href="{{ asset('bundles/expediente/plugins/boostrap3/css/bootstrap_flatly.min.css') }}" type="text/css" rel="stylesheet"> 

      <link rel="stylesheet" href="{{ asset('bundles/expediente/plugins/font-awesome/css/font-awesome.min.css') }}">  

      <link href="{{ asset('bundles/expediente/plugins/datatables/jquery.dataTables.min.css')}}" type="text/css" rel="stylesheet">
      <link href="{{ asset('bundles/expediente/plugins/select2/css/select2.min.css') }}" rel="stylesheet">     
      <link href="{{ asset('bundles/expediente/plugins/dropzone/dist/dropzone.css') }}" rel="stylesheet">
      <style type="text/css" media="print">
        @media print {
            a[href]:after {
                content: none !important;
            }
        }
      </style>     
{% endblock %}

{% block header %}
        {{ include('ExpedienteBundle:Default:_breadcrumb.html.twig') }}
{% endblock %}

{% block mensaje %}
 {{ include('ExpedienteBundle:Default:_mensaje.html.twig') }}
{% endblock %}
{% block footer %}
<dir class="footer"></dir>
{% endblock %}
{% block javascripts %} 
    <script src="{{ asset('bundles/expediente/plugins/jquery/jquery.min.js') }}">
    </script>
    <script src="{{ asset('bundles/expediente/plugins/boostrap3/js/bootstrap.min.js') }}">
    </script>         
    <script src="{{ asset('bundles/expediente/plugins/print/printArea.js') }}">
    </script> 
    <script src="{{ asset('bundles/expediente/plugins/dropzone/dist/dropzone.js') }}"></script>
    <script src="{{ asset('bundles/expediente/plugins/datatables/jquery.dataTables.min.js') }}"></script>
    <script>  
        var URL = "{{ app.request.getSchemeAndHttpHost()}}";
    </script>
    <script src="{{ asset('bundles/expediente/plugins/clipboard/dist/clipboard.min.js') }}"></script>
    <script src="{{ asset('bundles/tetranzselect2entity/js/select2entity.js') }}"></script>
    <script src="{{ asset('bundles/expediente/plugins/select2/js/select2.min.js') }}"></script>
    <script src="{{ asset('bundles/expediente/plugins/ckeditor/ckeditor.js') }}"></script>

<script>
    $.fn.modal.Constructor.prototype.enforceFocus = function() {};
    <!-- $('select').select2({  allowClear:true, placeholder:""}); -->

          $('select').select2({width:'100%', allowClear:true, placeholder:"Seleccionar"});

           <!--POPOVER-->
          $('#popover-nuevo').popover('show');
          $('body').on('click', function (e) {
          $('[data-toggle=popover]').each(function () {
              // hide any open popovers when the anywhere else in the body is clicked
              if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
                  $(this).popover('hide');
              }
          });
         });
          $('#popover-dos').popover('show');
          $('body').on('click', function (e) {
          $('[data-toggle=popover]').each(function () {
              // hide any open popovers when the anywhere else in the body is clicked
              if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
                  $(this).popover('hide');
              }
          });
         });
 <!--MODULO EXPEDIENTE -->
$("#siarme_expedientebundle_expediente_Tramite_0_PresupuestoOficial").change(function() {
  let str = $(this).val();
  str = str.replace("$", "");
  str = str.replace(".", "");
  str = str.replace(".", "");
  str = str.replace(".", "");
  str = str.trim();
  $("#siarme_expedientebundle_expediente_Tramite_0_PresupuestoOficial").val(str);
            });

$("#siarme_expedientebundle_expediente_numeroGde").change(function() {
  let str = $(this).val();
  str = str.trim();
  $("#siarme_expedientebundle_expediente_numeroGde").val(str);
            });

<!-- MODULO TRAMITE -->
/**
 * Crea un contador de tiempo que se actualiza cada segundo y que muestra
 * cuánto falta para que expire la oferta.
 */
function muestraCuentaAtras(id, fecha) {
    var horas, minutos, segundos;
    
    var ahora = new Date();
    var fechaExpiracion = new Date(fecha.ano, fecha.mes, fecha.dia, fecha.hora, fecha.minuto, fecha.segundo);
    
    var falta = Math.floor( (fechaExpiracion.getTime() - ahora.getTime()) / 1000 );
    
    if (falta < 0) {
        cuentaAtras = 'Finalizado';
    }
    else {
        horas = Math.floor(falta/3600);
        falta = falta % 3600;
        
        minutos = Math.floor(falta/60);
        falta = falta % 60;
        
        segundos = Math.floor(falta);
        
        cuentaAtras = (horas < 10    ? '0' + horas    : horas)    + 'h '
                    + (minutos < 10  ? '0' + minutos  : minutos)  + 'm '
                    + (segundos < 10 ? '0' + segundos : segundos) + 's ';
        
        setTimeout(function() {
            muestraCuentaAtras(id, fecha);
        }, 1000);
    }
    
    document.getElementById(id).innerHTML = cuentaAtras;
}





$(".btn-nuevoCredito").unbind('click').click( function(){
        var $href= $(this).attr("data-href");
        
        $.ajax({
             url: URL+$href,
             type: 'GET',
             success: function(response){
             var msj= document.getElementById("modal-body-credito");
             msj.innerHTML =response;
             $('#modal-credito').modal('show');
             $("#siarme_expedientebundle_credito_monto").change(function() {
                  let str = $(this).val();
                  str = str.replace("$", "");
                  str = str.replace(".", "");
                  str = str.replace(".", "");
                  str = str.replace(".", "");
                  str = str.trim();
                  $("#siarme_expedientebundle_credito_monto").val(str);
             });
             } 
        }); 
    });
    
$(".organismo_accion").unbind('click').click( function(){
        var $href= $(this).attr("data-href");
        $.ajax({
             url: URL+$href,
             type: 'GET',
             success: function(response){
             location.reload(true);
              

             } 
         
        }); 
      
    });


$(".btn-editarCredito").unbind('click').click( function(){
        var $href= $(this).attr("data-href");
        
        $.ajax({
             url: URL+$href,
             type: 'GET',
             success: function(response){
             var msj= document.getElementById("modal-body-credito");
             msj.innerHTML =response;
             $('#modal-credito').modal('show');
             $("#siarme_expedientebundle_credito_monto").change(function() {
                  let str = $(this).val();
                  str = str.replace("$", "");
                  str = str.replace(".", "");
                  str = str.replace(".", "");
                  str = str.replace(".", "");
                  str = str.trim();
                  $("#siarme_expedientebundle_credito_monto").val(str);
            });             
            } 
        }); 
    });

$("#siarme_expedientebundle_tramite_numeroComprar").change(function() {
  let str = $(this).val();
  str = str.trim();
  $("#siarme_expedientebundle_tramite_numeroComprar").val(str);
            });

  $("#siarme_expedientebundle_tramite_PresupuestoOficial").change(function() {
  let str = $(this).val();
  str = str.replace("$", "");
  str = str.replace(".", "");
  str = str.replace(".", "");
  str = str.replace(".", "");
  str = str.trim();

  $("#siarme_expedientebundle_tramite_PresupuestoOficial").val(str);
            });
            
  $(function () {
    $("#tablaTramite").DataTable({"searching": true,"lengthChange": true, "order": [[ 1, "desc" ]],"pageLength": 10,
            "language": {
                "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
            },"lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
        });
  });

    $('#tablaTramite tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );
    
  $(function () {
    $(".tablaTramite").DataTable({"searching": true,"lengthChange": true, "order": [[ 1, "desc" ]],"pageLength": 10,
            "language": {
                "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
            },"lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
        });
  });
    //boton cambiar es ESTADO item tramite pedido
    $(".btn-estado-item").unbind('click').click( function(){
        if ( $(this).find('.glyphicon').hasClass("glyphicon-check")){

         $(this).find('.glyphicon').removeClass("glyphicon-check").addClass("glyphicon-unchecked text-warning");
         $(this).parent().parent().find('.estado').html('Rectifiar');

        } else {

            $(this).find('.glyphicon').removeClass("glyphicon-unchecked text-warning").addClass("glyphicon-check");
            $(this).parent().parent().find('.estado').html('Válido');

        }
     //$(this).find('.glyphicon').toggleClass('glyphicon-unchecked','glyphicon-check');
    // $(this).parent().parent().find('.estado').html('Rectifiar');

        var $href= $(this).attr("data-href");

        //alert(URL+$
        $.ajax({

             url: URL+$href,
             type: 'POST',
             success: function(response){
                $(".estadoTramite").html("(Evaluación)");
                if($('#actualizar-pagina').is(':hidden')){
                    $('#actualizar-pagina').removeClass("hidden");
                }
                console.log( response);
             } 
        });

    });

$('.collapse').on('shown.bs.collapse', function(){
    $(this).parent().find(".glyphicon-plus").removeClass("glyphicon-plus text-info").addClass("glyphicon-minus");
    }).on('hidden.bs.collapse', function(){
    $(this).parent().find(".glyphicon-minus").removeClass("glyphicon-minus").addClass("glyphicon-plus text-info");
});


    //boton eliminar item tramite pedido
    $(".btn-eliminar-item").unbind('click').click( function(){
      var $op=confirm("¿Esta seguro de Eliminar el Item?");
      if ($op==true) {
        var $href= $(this).attr("data-href");
        //alert(URL+$href);
        $(this).parent().parent().addClass("hidden");
        $.ajax({

             url: URL+$href,
             type: 'POST',
             success: function(response){
                console.log( response);

             } 
        });
      } 
      
    });

  $(function () { // "order": [[ 1, "desc" ]]
    $("#tablaItemPedido").DataTable({"searching": true,"lengthChange": true, "order": [[ 1, "asc" ]],"pageLength": 10,
            "language": {
                "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
            }, "lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
        });
  });

  $(function () { // "order": [[ 1, "desc" ]]
    $(".tablaItem").DataTable({"searching": true,"lengthChange": true, "order": [[ 1, "asc" ]],"pageLength": -1,
            "language": {
                "url": "{{asset('bundles/expediente/plugins/datatables/extensions/language/Spanish.json')}}"
            }, "lengthMenu": [[10, 25, 50, 100,-1], [10, 25, 50, 100, "Todo"]],
        });
  });

    $('#tablaItemProceso tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );  

    $('#tablaItemPonderado tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );


    $('#tablaItemPedido tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );
    
    $('#tablaItemDuplicado tbody').on( 'click', 'tr', function () {
        $(this).toggleClass('selected');
    } );
  </script>

  <!--MODULO DOCUMENTO -->
<script>



var claseA = document.querySelectorAll('.file-icon');
for (var i = 0; i < claseA.length; i++) {
 console.log(claseA[i].dataset.type);
 var fileType =claseA[i].dataset.type
    switch(fileType) {
      case "pdf":
         claseA[i].className = "fa fa-file-pdf-o text-danger hidden-print";
        break;
      case "xlsx": case "xls": case "csv": case "ods":
         claseA[i].className = "fa fa-file-excel-o text-success hidden-print";
        break;
      case "docx": case "dox": case "txt":
         claseA[i].className = "fa fa-file-word-o text-primary hidden-print";
        break;
      case "pptx": case "ppt":
         claseA[i].className = "fa fa-file-powerpoint-o text-danger hidden-print";
        break;
      case "zip": case "rar":
         claseA[i].className = "fa fa-file-archive-o text-muted hidden-print";
        break;
      case "jpg": case "gif": case "png":  case "jpeg":
         claseA[i].className = "fa fa-file-image-o text-primary hidden-print";
        break;
      default:
         claseA[i].className = "fa fa-file-o text-primary hidden-print";
        
    } 

}
</script>


  <!-- 3. Instantiate clipboard by passing a list of HTML elements -->
    <script>
          var clipboard = new ClipboardJS('.btn');

          clipboard.on('success', function(e) {
              console.info('Action:', e.action);
              console.info('Text:', e.text);
              console.info('Trigger:', e.trigger);

             // e.clearSelection();
          });

          clipboard.on('error', function(e) {
              console.error('Action:', e.action);
              console.error('Trigger:', e.trigger);
          });
    </script>
    
    <script>

 /**   var introduction = document.getElementById('siarme_expedientebundle_comentario');
    introduction.setAttribute('contenteditable', true);

    CKEDITOR.inline('siarme_expedientebundle_comentario', {
      // Allow some non-standard markup that we used in the introduction.
      // Show toolbar on startup (optional).
      startupFocus: true
    });*/


        $(document).ready(function(){ //popTitle:"Documento"
          var options = {mode:"popup", popHt: 500,   popWd: 400, popX: 100,   popY: 100, popTitle:"", popClose: false, strict: undefined};
            $("#printer").click(function(){
            $("div.print").printArea(options); 
            });      
        });  
    </script>
 <script>
 $(function (){
    $("#alerta").unbind('click').click( function(){

        var $href= "{{ path('compartir_visto') }}";
        //alert(URL+$href);
        $(this).parent().parent().addClass("hidden");
        $.ajax({
             url: URL+$href,
             type: 'GET',
             success: function(response){
                console.log( response);
             } 
        });
      
    });
    

  });
</script>
<script>
 {# Esta duncion permite cargar cada 3 segundos un controlador bucando por 'id' la seccio donde cargar el html 
var myVar = setInterval(myTimer, 1000);

function myTimer() {

  $("#myId").load( "{{ path('datoat_turno_new' , { 'id': expediente.datoAt.id } ) }}");
} */#}

var myVar = setInterval(myTimer, 10000);

function myTimer() {

  $("#alerta").load( "{{ path('compartir_alerta') }}");
}

</script> 


  <script>
      var password = document.getElementById("password")
        , confirm_password = document.getElementById("confirm_password"), password_current = document.getElementById("passwordCurrent")
        , password_user = document.getElementById("passwordUser");

      function validatePassword(){
        if(password.value != confirm_password.value) {
          confirm_password.setCustomValidity("La contraseña no coincide");
        } else {
          confirm_password.setCustomValidity('');
        }
      }

      function validatePasswordUser(){
        if(password_user.value != password_current.value) {
          password_user.setCustomValidity("Ingrese la contraseña anterior");
        } else {
          password_user.setCustomValidity('');
        }
      }
      password_user.onchange = validatePasswordUser;
      password_user.onkeyup = validatePasswordUser;
      password.onchange = validatePassword;
      confirm_password.onkeyup = validatePassword;                              
  </script>
   <script>
        $(document).ready(function(){
                $('[data-toggle="tooltip"]').tooltip(); 

            });
        Dropzone.autoDiscover = false;
        new Dropzone(".dropzone", { 
            init: function() {
                this.on("queuecomplete", function (file) {
                   location.reload();
              });
            }
        });  
   </script>
   <script> 
   $(function() {
    $('a[data-toggle="tab"]').on('click', function(e) {
        window.localStorage.setItem('activeTab', $(e.target).attr('href'));
    });
    var activeTab = window.localStorage.getItem('activeTab');
    if (activeTab) {
        $('#myTab a[href="' + activeTab + '"]').tab('show');
        window.localStorage.removeItem("activeTab");
    }
});
   </script>
<script>
 $(function (){

    $(".btn-eliminar-comentario").unbind('click').click( function(){
      var $op=confirm("Esta seguro de Eliminar ");
      if ($op==true) {
        var $href= $(this).attr("data-href");
        //alert(URL+$href);
        $(this).parent().parent().addClass("hidden");
        $.ajax({

             url: URL+$href,
             type: 'GET',
             success: function(response){
                console.log( response);

             } 
        });
      } 
      
    });

  });
  $(function (){
    $(".btn-enviar-mensaje").unbind('click').click( function(){
     // var $op=confirm("Esta seguro de enviar mensaje ");
    //  if ($op==true) {
        var $numTel= $(this).attr("data-tel");
        //alert($href);

        var message =  $(this).attr("data-msj");;
        var number = $numTel;
        
        var url = "https://web.whatsapp.com/send?phone=54"+encodeURIComponent(number)+"&text="+encodeURIComponent(message)+'&source=&data=';
        window.open(url);
        return false;
      
    });

  });
</script>

{# CUANDO SE EDITA UN EXPEDIENTE Y SE BUSCA UN AGENTE #}
 <script>                
        $("#siarme_expedientebundle_expediente_agente").select2({
        placeholder: 'APELLIDO Y NOMBRE O DNI',
        minimumInputLength: 3,
        cache: true,
        ajax: {
           url: "{{ path('agente_search') }}",
           dataType: 'json',            
           delay: 5000,
           data: function (params) {
              return {
                      q: params.term // search term
                     };
           },
           processResults: function (data) {
             return {
                      results: $.map(data, function(obj) {
                         return { id: obj.id, text: obj.text };
                      })
                    };
           },
           
        },

        });
  </script>

{% endblock  %}
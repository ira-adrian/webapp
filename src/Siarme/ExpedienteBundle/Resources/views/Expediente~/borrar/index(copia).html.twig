{# Siarme/ExpedienteBundle/Resources/views/Extranet/index.html.twig #}
{% extends 'ExpedienteBundle:Default:layout.html.twig' %}
{% block menu_li %}
     <li>
          <a href="{{ path('expediente_index') }}" role="button"> <span class="glyphicon glyphicon-list-alt"> Lista de Expts. </span></a>
     </li>
     <li >
           <a href="{{ path('informe_new')  }}"  role="button"> <span class="glyphicon glyphicon-stats"> Generar Informe</span></a>
     </li>
     <li >
          <a href="{{ path('expediente_new') }}"  role="button"> <span class="glyphicon glyphicon-level-up"> Crear Expediente</span> </a>
      </li>   
      <form class="navbar-form navbar-right" method="POST" action="{{ path('expediente_index')}}" role="search">
          <div class="form-group">
            <input name="consulta"  type="text" class="form-control" placeholder="Buscar" required />
          </div>
          <button type="submit" class="btn btn-default" >Buscar</button>
      </form>
{% endblock %}

{% block contenido %}
{% block mensaje %}
 {{ include('ExpedienteBundle:Default:_mensaje.html.twig') }}
{% endblock %}
<div class="container-fluid">
<div class="count">
Total de Expedientes: <span class="label label-primary"> {{ pagination.getTotalItemCount }} </span>
</div>  <br>
<table class="table table-responsive table-hover">
<tr>
{# sorting of properties based on query components #}
    <th>{{ knp_pagination_sortable(pagination, 'Tramites', 't.') }}</th>
    <th>{{ knp_pagination_sortable(pagination, 'Expediente', 'e.letra') }}</th>
    <th {% if pagination.isSorted('a.Agente') %} class="sorted"{% endif %}> {{ knp_pagination_sortable(pagination, 'Agente', 'a.apellidoNombre') }} </th>
    <th>Extracto</th>
    <th {% if pagination.isSorted('c.Clasificacion') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Clasificacion', 'c.clasificacion') }}</th>
    <th>{{ knp_pagination_sortable(pagination, 'Acciones', 'e.estado') }}</th>
</tr>

{# table body #}
{% for expediente in pagination %}
<tr {% if loop.index is odd %}class="color"{% endif %}>
 <td>
                  {% if expediente.tramite | length > 0 %}
                     <span class="label label-default" data-toggle="tooltip" data-placement="top" title="Cantidad de Tramites" >{{expediente.tramite | length}}</span>
                 {% else %}
                    <p class="text-danger"><span class="glyphicon glyphicon-remove"></span></p> 
                {% endif %}
              </td>
              <td>
                <a data-toggle="tooltip" data-placement="top" title="Ver detalle de Expediente" href="{{ path('expediente_show', { 'id': expediente.id }) }}">{{ expediente}}</a>
              </td>
              <td> 
                 {{ expediente.agente }}
              </td>
              <td>
                {{ expediente.extracto }}
              </td>
              <td>                
                {{ expediente.clasificacion}}
              </td>
              <td>
                  {% if  (expediente.tramite | length > 0)%}
                  {% if expediente.estado %}
      
                  <a  class="label label-success" data-toggle="tooltip" data-placement="top" title="Concluir Expediente" href="{{ path('expediente_concluir', { 'id': expediente.id }) }}">EN CURSO...</a> 

                  {% else %}
                  <a class="label label-default" data-toggle="tooltip" data-placement="top" title="Iniciar Expediente" href="{{ path('expediente_iniciar', { 'id': expediente.id }) }}">CONCLUIDO</a>
                  {% endif %}
                  {% endif %}
              </td>

</tr>
{% endfor %}

</table>
{# display navigation #}
<div class="navigation pagination">
    {{ knp_pagination_render(pagination) }}
</div>
     </div>
{% endblock %}

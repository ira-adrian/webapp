{# obtengo los reportes para PROCESOS #}
{% set meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto",  "Septiembre",  "Octubre", "Noviembre", "Diciembre"] %}
{% set reporteProcesos = app.session.get('reporteProcesos') %}
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"> </script>
<script>

     $(document).ready(function(){
  $('[data-toggle="popover"]').popover('show');
});
/// activa el tab del menu principal
  $("#link-4").addClass('active');

    function currencyFormatDE(num) {
  return (
    '$ ' + num
              .toFixed(2) // always two decimal digits
              .replace('.', ',') // replace decimal point character with ,
              .replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.')
  ) // use . as a separator
}
window.onload = function () {

 CanvasJS.addCultureInfo("es", 
    {      
      decimalSeparator: ",",// Observe ToolTip Number Format
      digitGroupSeparator: ".", // Observe axisY labels                   
      days: ["domingo", "lunes", "martes", "miércoles", "jueves", "viernes", "sábado"],
      months: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]
      
    });
var chart = new CanvasJS.Chart("chartContainer", {
  theme: "light1", // "light2", "dark1", "dark2"
  culture: "es",
  animationEnabled: true,
  axisY: {
    title: "Montos",
    includeZero: true
  },
  legend: {
    cursor:"pointer",
    itemclick : toggleDataSeries
  },
  toolTip: {
    shared: true,
    content: toolTipFormatter
  },
  data: [{
    type: "bar",
    showInLegend: true,
    name: "Presupestado",
    color: "gold",
    dataPoints: [
{% for reporte  in reporteProcesos %}
{ y: {{reporte.montoPresupuestado}}, label: {% if reporte.mes == 0 %} '{{meses[reporte.mes ]}}' {% else %} '{{meses[reporte.mes - 1]}}' {% endif %} },
{% endfor %}
    ]
  },
  {
    type: "bar",
    showInLegend: true,
    name: "Adjudicado",
    color: "green",
    dataPoints: [
{% for reporte  in reporteProcesos %}
{ y: {{reporte.montoAdjudicado}}, label: {% if reporte.mes == 0 %} '{{meses[reporte.mes ]}}' {% else %} '{{meses[reporte.mes - 1]}}' {% endif %} },
{% endfor %}
    ]
  }]
});
chart.render();

function toolTipFormatter(e) {
  var str = "";
  var total = 0 ;
  var str3;
  var str2 ;
  for (var i = 0; i < e.entries.length; i++){
    var str1 = "<span style= \"color:"+e.entries[i].dataSeries.color + "\">" + e.entries[i].dataSeries.name + "</span>: <strong>"+  currencyFormatDE(e.entries[i].dataPoint.y) + "</strong> <br/>" ;
    total = e.entries[i].dataPoint.y - total;
    str = str.concat(str1);
  }
  str2 = "<strong>" + e.entries[0].dataPoint.label + "</strong> <br/>";

  str3 = "<span style = \"color:Tomato\">Diferencia: </span><strong>" + currencyFormatDE(total) + "</strong><br/>";
  return (str2.concat(str)).concat(str3);
}

function toggleDataSeries(e) {
  if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
    e.dataSeries.visible = false;
  }
  else {
    e.dataSeries.visible = true;
  }
  chart.render();
}

}
  /**
window.onload = function () {

  CanvasJS.addCultureInfo("es", 
    {      
      decimalSeparator: ",",// Observe ToolTip Number Format
      digitGroupSeparator: ".", // Observe axisY labels                   
      days: ["domingo", "lunes", "martes", "miércoles", "jueves", "viernes", "sábado"],
      months: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]
      
    });

var chart = new CanvasJS.Chart("chartContainer", {
  theme: "light1", // "light2", "dark1", "dark2"
  culture: "es",
  animationEnabled: true,
  title:{
    text: "Totales por Mes"
  },  
  axisY: {
    title: "Monto Presupestado",
    titleFontColor: "#4F81BC",
    lineColor: "#4F81BC",
    labelFontColor: "#4F81BC",
    tickColor: "#4F81BC"
  },
  axisY2: {
    title: "Monto Adjudicado",
    titleFontColor: "#C0504E",
    lineColor: "#C0504E",
    labelFontColor: "#C0504E",
    tickColor: "#C0504E"
    //valueFormatString:"MMMM"
  },  
  toolTip: {
    shared: true
  },
  legend: {
    cursor:"pointer",
    itemclick: toggleDataSeries
  },
  data: [{
    type: "column",
    name: "Presupestado",
    legendText: "Presupestado",
    showInLegend: true, 
    dataPoints:[
      { label: "Enero", y: 2616.21 },
      { label: "Febrero", y: 3102.25 },
      { label: "Marzo", y: 1157.20 },
      { label: "Abril", y: 1148.77 },
      { label: "Mayo", y: 1101.50 },
      { label: "Junio", y: 917.8 }
    ]
  },
  {
    type: "column", 
    name: "Adjudicado",
    legendText: "Adjudicado",
    axisYType: "secondary",
    showInLegend: true,
    dataPoints:[
      { label: "Enero", y: 1310.46 },
      { label: "Febrero", y: 1232.27 },
      { label: "Marzo", y: 2333.99 },
      { label: "Abril", y: 334.45 },
      { label: "Mayo", y: 833.92 },
      { label: "Junio", y: 1033.1 }
    ]
  }]
});
chart.render();

function toggleDataSeries(e) {
  if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
    e.dataSeries.visible = false;
  }
  else {
    e.dataSeries.visible = true;
  }
  chart.render();
}

}*/
</script>

